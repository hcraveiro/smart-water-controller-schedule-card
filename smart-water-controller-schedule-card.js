(()=>{class t{constructor(t){this.element=t,this.selectedElement=t.querySelector(".dropdown-selected"),this.optionsElement=t.querySelector(".dropdown-options"),this.options=Array.from(this.optionsElement.querySelectorAll(".dropdown-option")),this.selectedElement.addEventListener("click",()=>{this.toggleDropdown()}),this.options.forEach(t=>{t.addEventListener("click",()=>{this.selectOption(t)})})}toggleDropdown(){this.element.classList.toggle("open")}selectOption(t){const e=t.getAttribute("data-value");this.selectedElement.querySelector("span").textContent=t.textContent,this.toggleDropdown(),this.currentMonth=parseInt(e);const n=new CustomEvent("monthChanged",{detail:{month:this.currentMonth},bubbles:!0,composed:!0});this.element.dispatchEvent(n)}}class e extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.currentMonth=(new Date).getMonth(),this.scheduleData=null,this._hass=null}connectedCallback(){this.addEventListener("monthChanged",this.changeMonthFromDropdown)}disconnectedCallback(){this.removeEventListener("monthChanged",this.changeMonthFromDropdown)}setConfig(t){if(!t.sensor)throw new Error("You need to define a sensor in config.");this.sensor=t.sensor,this.mac_address=this.extractMacAddress(this.sensor),this.servicePrefix=null,this._hass&&!this.scheduleData?this.fetchSensorData():this.addEventListener("hass-connected",()=>this.fetchSensorData())}extractMacAddress(t){const e=t.match(/^sensor\.([0-9a-fA-F]{2}_[0-9a-fA-F]{2}_[0-9a-fA-F]{2}_[0-9a-fA-F]{2}_[0-9a-fA-F]{2}_[0-9a-fA-F]{2})_/);return e?e[1]:null}set hass(t){this._hass=t,this.scheduleData||this.fetchSensorData()}async fetchSensorData(){if(!this._hass||this.scheduleData)return;const t=this._hass.states[this.sensor];if(t&&t.attributes&&(this.servicePrefix=t.attributes.service_prefix||t.attributes.controller_service_prefix||null,t.attributes.schedule)){const e=t.attributes.schedule;e&&!this.scheduleData&&(this.scheduleData=JSON.parse(JSON.stringify(e)))}this.render()}handleMonthChange(){this.shadowRoot.querySelector(".card").classList.add("hidden"),setTimeout(()=>{this.render();const t=this.shadowRoot.querySelector(".card");t.classList.add("hidden"),setTimeout(()=>{t.classList.remove("hidden")},25)},200)}changeMonth(t){this.currentMonth=(this.currentMonth+t+12)%12,this.handleMonthChange()}changeMonthFromDropdown(t){this.currentMonth=t.detail.month,this.handleMonthChange()}updateIntervalDays(t){const e=this.scheduleData[this.currentMonth]||{hours:[],stations:{},interval_days:0};this.scheduleData={...this.scheduleData,[this.currentMonth]:{...e,interval_days:parseInt(t.target.value)||0}},this.render()}addTimeSlot(){this.scheduleData[this.currentMonth]||{hours:[],stations:{},interval_days:0}||(this.scheduleData[this.currentMonth]={hours:[],stations:{},interval_days:0}),this.scheduleData[this.currentMonth].hours||(this.scheduleData[this.currentMonth].hours=[]),this.scheduleData[this.currentMonth].hours.push("07:00:00"),this.render()}updateTimeSlot(t,e){const n=this.scheduleData[this.currentMonth]||{hours:[],stations:{},interval_days:0};n&&n.hours&&(n.hours[t]=e.target.value,this.render())}removeTimeSlot(t){const e=this.scheduleData[this.currentMonth]||{hours:[],stations:{},interval_days:0};e&&e.hours&&e.hours.length>t&&(e.hours.splice(t,1),this.render())}updateStationTime(t,e){const n=this.scheduleData[this.currentMonth]||{hours:[],stations:{},interval_days:0};this.scheduleData={...this.scheduleData,[this.currentMonth]:{...n,stations:{...n.stations,[t]:parseInt(e.target.value)||0}}},this.render()}saveSchedule(){const t=Object.keys(this.scheduleData).sort((t,e)=>t-e).map(t=>this.scheduleData[t]);if(!this.servicePrefix)return void console.error("Service prefix not available in sensor attributes. Please expose 'service_prefix' in the Controller Status sensor.");const e=`set_irrigation_schedule_${this.servicePrefix}`;this._hass.callService("smart_water_controller",e,{schedule:t}),this.showSaveNotification()}showSaveNotification(){const t=document.createElement("div");t.textContent="Schedule saved successfully!",t.style.position="fixed",t.style.top="20px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.backgroundColor="#28a745",t.style.color="#fff",t.style.padding="10px 20px",t.style.borderRadius="5px",t.style.fontSize="1em",t.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.2)",t.style.zIndex="1000",document.body.appendChild(t),setTimeout(()=>{t.remove()},3e3)}findAllElementsRecursively(t,e){let n=[];return t?(t.shadowRoot&&n.push(...this.findAllElementsRecursively(t.shadowRoot,e)),(t instanceof Document||t instanceof ShadowRoot)&&n.push(...t.querySelectorAll(e)),t.childNodes.forEach(t=>{n.push(...this.findAllElementsRecursively(t,e))}),n):n}render(){if(!this.shadowRoot||!this.scheduleData)return;const e=this.scheduleData[this.currentMonth]||{hours:[],stations:{},interval_days:0};this.shadowRoot.innerHTML=`\n            <style>\n                @keyframes fadeInOut {\n                    0% {\n                        opacity: 0;\n                        visibility: hidden;\n                    }\n                    50% {\n                        opacity: 1;\n                        visibility: visible;\n                    }\n                    100% {\n                        opacity: 0;\n                        visibility: hidden;\n                    }\n                }\n                .card-transition {\n                    animation: fadeInOut 1s ease-in-out forwards;\n                }\n                /* Estilo do card */\n                .card {\n                    background-color: white;\n                    padding: 20px;\n                    border-radius: 12px;\n                    box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.1); /* Sombra suave */\n                    transition: box-shadow 0.3s ease; /* Somente a sombra ir√° transitar */\n                }\n                \n                /* Efeito de hover sem movimenta√ß√£o */\n                .card:hover {\n                    box-shadow: 0px 6px 16px rgba(0, 0, 0, 0.15); /* A sombra aumenta ao passar o mouse */\n                }\n                \n                /* Efeito de foco no card */\n                .card:focus {\n                    outline: none;\n                    border: 2px solid #007BFF; /* Foco azul */\n                }\n                .card.hidden {\n                    opacity: 0;\n                }\n                .header {\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                    font-size: 1.2em;\n                    font-weight: bold;\n                }\n                .month-selector button {\n                    background: none;\n                    border: none;\n                    font-size: 20px;\n                    cursor: pointer;\n                }\n                .month-selector select {\n                    font-size: 1em;\n                    padding: 5px;\n                    border-radius: 5px;\n                }\n                .schedule-list {\n                    margin-top: 10px;\n                }\n                .section {\n                    margin-top: 10px;\n                    padding: 10px;\n                    border-radius: 5px;\n                    background: #ffffff;\n                    box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n                    padding: 10px;\n                }\n                .section h3 {\n                    margin: 0;\n                    font-size: 1.1em;\n                    font-weight: bold;\n                    color: #0073e6;\n                    border-bottom: 2px solid #0073e6;\n                    padding-bottom: 5px;\n                    margin-bottom: 8px;\n                }\n                .section input {\n                    width: 100%;\n                    padding: 5px;\n                    margin-top: 5px;\n                    font-size: 1em;\n                }\n                .buttons {\n                    display: flex;\n                    justify-content: space-between;\n                    margin-top: 10px;\n                }\n                .btn {\n                    background-color: #0073e6;\n                    color: white;\n                    border: none;\n                    padding: 10px;\n                    border-radius: 5px;\n                    cursor: pointer;\n                    font-size: 1em;\n                }\n                .btn-danger {\n                    background-color: #e60000;\n                }\n                .section div {\n                    display: flex;\n                    align-items: center;\n                    margin-bottom: 8px;\n                }\n                .section div span {\n                    margin-right: 10px; /* Espa√ßo entre a label e o input */\n                    white-space: nowrap; /* Impede que o texto da label quebre para a linha seguinte */\n                }\n                .section div input {\n                    flex-grow: 1;\n                    margin-right: 10px; /* Espa√ßo entre o input e o bot√£o */\n                }\n                .section div button {\n                    margin-left: 10px; /* Espa√ßo √† esquerda do bot√£o */\n                }\n            \n                /* Estilos espec√≠ficos para os √≠cones de emojis */\n                .btn i, .btn span, .btn-danger i, .btn-danger span {\n                    color: transparent !important; /* Tornar a cor do emoji transparente */\n                    text-shadow: 0 0 0 white !important; /* Aplicar o texto em branco via sombra */\n                    font-size: inherit; /* Garantir que o tamanho do emoji seja o mesmo do bot√£o */\n                }\n                /* Estilo do dropdown */\n                .custom-dropdown {\n                    position: relative;\n                    width: 200px;\n                    font-size: 14px;\n                    border-radius: 6px;\n                    background-color: #007BFF;\n                    color: white;\n                    cursor: pointer;\n                }\n                \n                /* Estilo do item selecionado */\n                .dropdown-selected {\n                    padding: 6px 10px;\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                }\n            \n                /* Estilo da seta */\n                .dropdown-arrow {\n                    font-size: 14px;\n                }\n                \n                /* Estilo da lista de op√ß√µes */\n                .dropdown-options {\n                    display: none; /* Esconde as op√ß√µes por padr√£o */\n                    position: absolute;\n                    background-color: #007BFF;\n                    min-width: 160px;\n                    box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);\n                    z-index: 1;\n                }\n                \n                /* Exibe as op√ß√µes quando o dropdown estiver aberto */\n                .dropdown.open .dropdown-options {\n                    display: block;\n                }\n            \n                /* Estilo de cada op√ß√£o dentro do dropdown */\n                .dropdown-option {\n                    padding: 6px 10px;\n                    cursor: pointer;\n                }\n            \n                /* Hover para op√ß√µes */\n                .dropdown-option:hover {\n                    background-color: #004085;\n                }\n                /* Efeito de hover do dropdown */\n                .custom-dropdown:hover .dropdown-options {\n                    display: block;\n                }\n            </style>\n\n            <ha-card class="card">\n                <div class="header">\n                    <button class="prev">‚¨Ö</button>\n                    <div class="custom-dropdown">\n                        <div class="dropdown-selected">\n                            <span>${new Date(2025,this.currentMonth,1).toLocaleString("default",{month:"long"})}</span>\n                            <div class="dropdown-arrow">‚ñº</div>\n                        </div>\n                        <div class="dropdown-options">\n                            ${[...Array(12).keys()].map(t=>`\n                                <div class="dropdown-option" data-value="${t}">\n                                    ${new Date(2025,t,1).toLocaleString("default",{month:"long"})}\n                                </div>\n                            `).join("")}\n                        </div>\n                    </div>\n                    <button class="next">‚û°</button>\n                </div>\n                <div class="schedule-list">\n                    <div class="section">\n                        <h3>Interval between sprinkles (days)</h3>\n                        <input type="number" value="${e.interval_days}" \n                            oninput="this.getRootNode().host.updateIntervalDays(event)">\n                    </div>\n                    <div class="section">\n                        <h3>Scheduled times</h3>\n                        ${e.hours.map((t,e)=>` \n                            <div>\n                                <input type="time" value="${t}" \n                                    oninput="this.getRootNode().host.updateTimeSlot(${e}, event)">\n                                <button class="btn btn-danger" onclick="this.getRootNode().host.removeTimeSlot(${e})"><span>‚ùå</span></button>\n                            </div>\n                        `).join("")}\n                        <button class="btn btn-add-time" onclick="this.getRootNode().host.addTimeSlot()"><span>‚ûï</span> Add Time</button>\n                    </div>\n                    <div class="section">\n                        <h3>Sprinkle time per station (minutes)</h3>\n                        ${Object.entries(e.stations).map(([t,e])=>` \n                            <div>\n                                <span>${t.replace("_minutes","").replace("station_","Station ")}</span>\n                                <input type="number" value="${e}" \n                                    oninput="this.getRootNode().host.updateStationTime('${t}', event)">\n                            </div>\n                        `).join("")}\n                    </div>\n                </div>\n                <div class="buttons">\n                    <button class="btn" onclick="this.getRootNode().host.saveSchedule()">üíæ Save</button>\n                </div>\n            </ha-card>\n        `;const n=this.shadowRoot.querySelector(".prev"),o=this.shadowRoot.querySelector(".next");n.replaceWith(n.cloneNode(!0)),o.replaceWith(o.cloneNode(!0)),this.shadowRoot.querySelector(".prev").addEventListener("click",()=>this.changeMonth(-1)),this.shadowRoot.querySelector(".next").addEventListener("click",()=>this.changeMonth(1));const s=document.querySelector("home-assistant");let i=[];setTimeout(()=>{i=this.findAllElementsRecursively(s,"smart-water-controller-schedule-card"),i.forEach(e=>{if(e.shadowRoot){const n=e.shadowRoot.querySelector(".custom-dropdown");n&&new t(n)}})},100),document.addEventListener("click",t=>{const e=t.composedPath().find(t=>"smart-water-controller-schedule-card"===t.tagName?.toLowerCase());if(e&&e.shadowRoot){const t=e.shadowRoot.querySelector(".custom-dropdown");t&&t.click()}})}}customElements.define("smart-water-controller-schedule-card",e)})();